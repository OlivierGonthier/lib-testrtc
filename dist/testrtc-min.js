!function r(a,o,d){function c(e,t){if(!o[e]){if(!a[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(h)return h(e,!0);var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}var n=o[e]={exports:{}};a[e][0].call(n.exports,function(t){return c(a[e][1][t]||t)},n,n.exports,r,a,o,d)}return o[e].exports}for(var h="function"==typeof require&&require,t=0;t<d.length;t++)c(d[t]);return c}({1:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});i.cases={AUDIOCAPTURE:"Audio capture",CHECKRESOLUTION240:"Check resolution 320x240",CHECKRESOLUTION480:"Check resolution 640x480",CHECKRESOLUTION720:"Check resolution 1280x720",CHECKSUPPORTEDRESOLUTIONS:"Check supported resolutions",DATATHROUGHPUT:"Data throughput",IPV6ENABLED:"Ipv6 enabled",NETWORKLATENCY:"Network latency",NETWORKLATENCYRELAY:"Network latency - Relay",UDPENABLED:"Udp enabled",TCPENABLED:"Tcp enabled",VIDEOBANDWIDTH:"Video bandwidth",RELAYCONNECTIVITY:"Relay connectivity",REFLEXIVECONNECTIVITY:"Reflexive connectivity",HOSTCONNECTIVITY:"Host connectivity"},i.suites={CAMERA:"Camera",MICROPHONE:"Microphone",NETWORK:"Network",CONNECTIVITY:"Connectivity",THROUGHPUT:"Throughput"}},{}],2:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function s(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(t,e,i){return e&&s(t.prototype,e),i&&s(t,i),t}}(),n=l(t("./util/call.js"));t("./util/stats.js"),t("./util/ssim.js"),t("./util/videoframechecker.js"),t("./util/util.js");var r=t("./config/testNames.js"),a=l(t("./unit/mic.js")),o=l(t("./unit/conn.js")),d=l(t("./unit/camresolutions.js")),c=l(t("./unit/net.js")),h=l(t("./unit/dataBandwidth.js")),u=l(t("./unit/videoBandwidth.js"));l(t("./unit/wifiPeriodicScan.js"));function l(t){return t&&t.__esModule?t:{default:t}}var p=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.enumeratedTestSuites=[],this.enumeratedTestFilters=[],addTest(r.suites.MICROPHONE,r.cases.AUDIOCAPTURE,function(t){new a.default(t).run()}),addTest(r.suites.CONNECTIVITY,r.cases.RELAYCONNECTIVITY,function(t){new o.default(t,n.default.isRelay).run()}),addTest(r.suites.CONNECTIVITY,r.cases.REFLEXIVECONNECTIVITY,function(t){new o.default(t,n.default.isReflexive).run()}),addTest(r.suites.CONNECTIVITY,r.cases.HOSTCONNECTIVITY,function(t){new o.default(t,n.default.isHost).start()}),addTest(r.suites.CAMERA,r.cases.CHECKRESOLUTION240,function(t){new d.default(t,[[320,240]]).run()}),addTest(r.suites.CAMERA,r.cases.CHECKRESOLUTION480,function(t){new d.default(t,[[640,480]]).run()}),addTest(r.suites.CAMERA,r.cases.CHECKRESOLUTION720,function(t){new d.default(t,[[1280,720]]).run()}),addTest(r.suites.CAMERA,r.cases.CHECKSUPPORTEDRESOLUTIONS,function(t){new d.default(t,[[160,120],[320,180],[320,240],[640,360],[640,480],[768,576],[1024,576],[1280,720],[1280,768],[1280,800],[1920,1080],[1920,1200],[3840,2160],[4096,2160]]).run()}),addTest(r.suites.NETWORK,r.cases.UDPENABLED,function(t){new c.default(t,"udp",null,n.default.isRelay).run()}),addTest(r.suites.NETWORK,r.cases.TCPENABLED,function(t){new c.default(t,"tcp",null,n.default.isRelay).run()}),addTest(r.suites.NETWORK,r.cases.IPV6ENABLED,function(t){new c.default(t,null,{optional:[{googIPv6:!0}]},n.default.isIpv6).run()}),addTest(r.suites.THROUGHPUT,r.cases.DATATHROUGHPUT,function(t){new h.default(t).run()}),addTest(r.suites.THROUGHPUT,r.cases.VIDEOBANDWIDTH,function(t){new u.default(t).run()}),addExplicitTest(r.suites.THROUGHPUT,r.cases.NETWORKLATENCY,function(t){new WiFiPeriodicScanTest(t,n.default.isNotHostCandidate).run()}),addExplicitTest(r.suites.THROUGHPUT,r.cases.NETWORKLATENCYRELAY,function(t){new WiFiPeriodicScanTest(t,n.default.isRelay).run()})}return s(t,[{key:"addTest",value:function(t,e,i){if(!isTestDisabled(e))for(var s=0;s!==enumeratedTestSuites.length;++s)if(enumeratedTestSuites[s].name===t)return void enumeratedTestSuites[s].addTest(e,i)}},{key:"addExplicitTest",value:function(t,e,i){isTestExplicitlyEnabled(e)&&addTest(t,e,i)}},{key:"isTestDisabled",value:function(t){return 0!==enumeratedTestFilters.length&&!isTestExplicitlyEnabled(t)}},{key:"isTestExplicitlyEnabled",value:function(t){for(var e=0;e!==enumeratedTestFilters.length;++e)if(enumeratedTestFilters[e]===t)return!0;return!1}}]),t}();i.default=p},{"./config/testNames.js":1,"./unit/camresolutions.js":5,"./unit/conn.js":6,"./unit/dataBandwidth.js":7,"./unit/mic.js":8,"./unit/net.js":9,"./unit/videoBandwidth.js":10,"./unit/wifiPeriodicScan.js":11,"./util/call.js":12,"./util/ssim.js":14,"./util/stats.js":15,"./util/util.js":16,"./util/videoframechecker.js":17}],3:[function(t,e,i){"use strict";try{window.AudioContext=window.AudioContext||window.webkitAudioContext;new AudioContext}catch(t){console.log("Failed to instantiate an audio context, error: "+t)}var s=parseUrlParameters(),n="test_filter";n in s&&s[n].split(",")},{}],4:[function(t,e,i){"use strict";function s(t,e){this.test=t,this.resolutions=e,this.currentResolution=0,this.isMuted=!1,this.isShuttingDown=!1}Object.defineProperty(i,"__esModule",{value:!0}),s.prototype={run:function(){this.startGetUserMedia(this.resolutions[this.currentResolution])},startGetUserMedia:function(e){var t={audio:!1,video:{width:{exact:e[0]},height:{exact:e[1]}}};navigator.mediaDevices.getUserMedia(t).then(function(t){1<this.resolutions.length?(this.test.reportSuccess("Supported: "+e[0]+"x"+e[1]),t.getTracks().forEach(function(t){t.stop()}),this.maybeContinueGetUserMedia()):this.collectAndAnalyzeStats_(t,e)}.bind(this)).catch(function(t){1<this.resolutions.length?this.test.reportInfo(e[0]+"x"+e[1]+" not supported"):this.test.reportError("getUserMedia failed with error: "+t.name),this.maybeContinueGetUserMedia()}.bind(this))},maybeContinueGetUserMedia:function(){this.currentResolution!==this.resolutions.length?this.startGetUserMedia(this.resolutions[this.currentResolution++]):this.test.done()},collectAndAnalyzeStats_:function(t,e){var i=t.getVideoTracks();if(i.length<1)return this.test.reportError("No video track in returned stream."),void this.maybeContinueGetUserMedia();var s=i[0];"function"==typeof s.addEventListener&&(s.addEventListener("ended",function(){this.isShuttingDown||this.test.reportError("Video track ended, camera stopped working")}.bind(this)),s.addEventListener("mute",function(){this.isShuttingDown||(this.test.reportWarning("Your camera reported itself as muted."),this.isMuted=!0)}.bind(this)),s.addEventListener("unmute",function(){this.isShuttingDown||(this.test.reportInfo("Your camera reported itself as unmuted."),this.isMuted=!1)}.bind(this)));var n=document.createElement("video");n.setAttribute("autoplay",""),n.setAttribute("muted",""),n.width=e[0],n.height=e[1],n.srcObject=t;var r=new VideoFrameChecker(n),a=new Call(null,this.test);a.pc1.addStream(t),a.establishConnection(),a.gatherStats(a.pc1,null,t,this.onCallEnded_.bind(this,e,n,t,r),100),setTimeoutWithProgressBar(this.endCall_.bind(this,a,t),8e3)},onCallEnded_:function(t,e,i,s,n,r){this.analyzeStats_(t,e,i,s,n,r),s.stop(),this.test.done()},analyzeStats_:function(t,e,i,s,n,r){var a=[],o=[],d=[],c={},h=s.frameStats;for(var u in n)"ssrc"===n[u].type&&0<parseInt(n[u].googFrameRateInput)&&(a.push(parseInt(n[u].googAvgEncodeMs)),o.push(parseInt(n[u].googFrameRateInput)),d.push(parseInt(n[u].googFrameRateSent)));c.cameraName=i.getVideoTracks()[0].label||NaN,c.actualVideoWidth=e.videoWidth,c.actualVideoHeight=e.videoHeight,c.mandatoryWidth=t[0],c.mandatoryHeight=t[1],c.encodeSetupTimeMs=this.extractEncoderSetupTime_(n,r),c.avgEncodeTimeMs=arrayAverage(a),c.minEncodeTimeMs=arrayMin(a),c.maxEncodeTimeMs=arrayMax(a),c.avgInputFps=arrayAverage(o),c.minInputFps=arrayMin(o),c.maxInputFps=arrayMax(o),c.avgSentFps=arrayAverage(d),c.minSentFps=arrayMin(d),c.maxSentFps=arrayMax(d),c.isMuted=this.isMuted,c.testedFrames=h.numFrames,c.blackFrames=h.numBlackFrames,c.frozenFrames=h.numFrozenFrames,report.traceEventInstant("video-stats",c),this.testExpectations_(c)},endCall_:function(t,e){this.isShuttingDown=!0,e.getTracks().forEach(function(t){t.stop()}),t.close()},extractEncoderSetupTime_:function(t,e){for(var i=0;i!==t.length;i++)if("ssrc"===t[i].type&&0<parseInt(t[i].googFrameRateInput))return JSON.stringify(e[i]-e[0]);return NaN},resolutionMatchesIndependentOfRotationOrCrop_:function(t,e,i,s){var n=Math.min(i,s);return t===i&&e===s||t===s&&e===i||t===n&&s===n},testExpectations_:function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&("number"==typeof t[i]&&isNaN(t[i])?e.push(i):this.test.reportInfo(i+": "+t[i]));0!==e.length&&this.test.reportInfo("Not available: "+e.join(", ")),isNaN(t.avgSentFps)?this.test.reportInfo("Cannot verify sent FPS."):t.avgSentFps<5?this.test.reportError("Low average sent FPS: "+t.avgSentFps):this.test.reportSuccess("Average FPS above threshold"),this.resolutionMatchesIndependentOfRotationOrCrop_(t.actualVideoWidth,t.actualVideoHeight,t.mandatoryWidth,t.mandatoryHeight)?this.test.reportSuccess("Captured video using expected resolution."):this.test.reportError("Incorrect captured resolution."),0===t.testedFrames?this.test.reportError("Could not analyze any video frame."):(t.blackFrames>t.testedFrames/3&&this.test.reportError("Camera delivering lots of black frames."),t.frozenFrames>t.testedFrames/3&&this.test.reportError("Camera delivering lots of frozen frames."))}},i.default=s},{}],5:[function(t,e,i){"use strict";function s(t,e){this.test=t,this.resolutions=e,this.currentResolution=0,this.isMuted=!1,this.isShuttingDown=!1}Object.defineProperty(i,"__esModule",{value:!0}),s.prototype={run:function(){this.startGetUserMedia(this.resolutions[this.currentResolution])},startGetUserMedia:function(e){var t={audio:!1,video:{width:{exact:e[0]},height:{exact:e[1]}}};navigator.mediaDevices.getUserMedia(t).then(function(t){1<this.resolutions.length?(this.test.reportSuccess("Supported: "+e[0]+"x"+e[1]),t.getTracks().forEach(function(t){t.stop()}),this.maybeContinueGetUserMedia()):this.collectAndAnalyzeStats_(t,e)}.bind(this)).catch(function(t){1<this.resolutions.length?this.test.reportInfo(e[0]+"x"+e[1]+" not supported"):this.test.reportError("getUserMedia failed with error: "+t.name),this.maybeContinueGetUserMedia()}.bind(this))},maybeContinueGetUserMedia:function(){this.currentResolution!==this.resolutions.length?this.startGetUserMedia(this.resolutions[this.currentResolution++]):this.test.done()},collectAndAnalyzeStats_:function(t,e){var i=t.getVideoTracks();if(i.length<1)return this.test.reportError("No video track in returned stream."),void this.maybeContinueGetUserMedia();var s=i[0];"function"==typeof s.addEventListener&&(s.addEventListener("ended",function(){this.isShuttingDown||this.test.reportError("Video track ended, camera stopped working")}.bind(this)),s.addEventListener("mute",function(){this.isShuttingDown||(this.test.reportWarning("Your camera reported itself as muted."),this.isMuted=!0)}.bind(this)),s.addEventListener("unmute",function(){this.isShuttingDown||(this.test.reportInfo("Your camera reported itself as unmuted."),this.isMuted=!1)}.bind(this)));var n=document.createElement("video");n.setAttribute("autoplay",""),n.setAttribute("muted",""),n.width=e[0],n.height=e[1],n.srcObject=t;var r=new VideoFrameChecker(n),a=new Call(null,this.test);a.pc1.addStream(t),a.establishConnection(),a.gatherStats(a.pc1,null,t,this.onCallEnded_.bind(this,e,n,t,r),100),setTimeoutWithProgressBar(this.endCall_.bind(this,a,t),8e3)},onCallEnded_:function(t,e,i,s,n,r){this.analyzeStats_(t,e,i,s,n,r),s.stop(),this.test.done()},analyzeStats_:function(t,e,i,s,n,r){var a=[],o=[],d=[],c={},h=s.frameStats;for(var u in n)"ssrc"===n[u].type&&0<parseInt(n[u].googFrameRateInput)&&(a.push(parseInt(n[u].googAvgEncodeMs)),o.push(parseInt(n[u].googFrameRateInput)),d.push(parseInt(n[u].googFrameRateSent)));c.cameraName=i.getVideoTracks()[0].label||NaN,c.actualVideoWidth=e.videoWidth,c.actualVideoHeight=e.videoHeight,c.mandatoryWidth=t[0],c.mandatoryHeight=t[1],c.encodeSetupTimeMs=this.extractEncoderSetupTime_(n,r),c.avgEncodeTimeMs=arrayAverage(a),c.minEncodeTimeMs=arrayMin(a),c.maxEncodeTimeMs=arrayMax(a),c.avgInputFps=arrayAverage(o),c.minInputFps=arrayMin(o),c.maxInputFps=arrayMax(o),c.avgSentFps=arrayAverage(d),c.minSentFps=arrayMin(d),c.maxSentFps=arrayMax(d),c.isMuted=this.isMuted,c.testedFrames=h.numFrames,c.blackFrames=h.numBlackFrames,c.frozenFrames=h.numFrozenFrames,report.traceEventInstant("video-stats",c),this.testExpectations_(c)},endCall_:function(t,e){this.isShuttingDown=!0,e.getTracks().forEach(function(t){t.stop()}),t.close()},extractEncoderSetupTime_:function(t,e){for(var i=0;i!==t.length;i++)if("ssrc"===t[i].type&&0<parseInt(t[i].googFrameRateInput))return JSON.stringify(e[i]-e[0]);return NaN},resolutionMatchesIndependentOfRotationOrCrop_:function(t,e,i,s){var n=Math.min(i,s);return t===i&&e===s||t===s&&e===i||t===n&&s===n},testExpectations_:function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&("number"==typeof t[i]&&isNaN(t[i])?e.push(i):this.test.reportInfo(i+": "+t[i]));0!==e.length&&this.test.reportInfo("Not available: "+e.join(", ")),isNaN(t.avgSentFps)?this.test.reportInfo("Cannot verify sent FPS."):t.avgSentFps<5?this.test.reportError("Low average sent FPS: "+t.avgSentFps):this.test.reportSuccess("Average FPS above threshold"),this.resolutionMatchesIndependentOfRotationOrCrop_(t.actualVideoWidth,t.actualVideoHeight,t.mandatoryWidth,t.mandatoryHeight)?this.test.reportSuccess("Captured video using expected resolution."):this.test.reportError("Incorrect captured resolution."),0===t.testedFrames?this.test.reportError("Could not analyze any video frame."):(t.blackFrames>t.testedFrames/3&&this.test.reportError("Camera delivering lots of black frames."),t.frozenFrames>t.testedFrames/3&&this.test.reportError("Camera delivering lots of frozen frames."))}},i.default=s},{}],6:[function(t,e,i){"use strict";function s(t,e){this.test=t,this.iceCandidateFilter=e,this.timeout=null,this.parsedCandidates=[],this.call=null}Object.defineProperty(i,"__esModule",{value:!0}),s.prototype={run:function(){Call.asyncCreateTurnConfig(this.start.bind(this),this.test.reportFatal.bind(this.test))},start:function(t){this.call=new Call(t,this.test),this.call.setIceCandidateFilter(this.iceCandidateFilter),this.call.pc1.addEventListener("icecandidate",function(t){if(t.candidate){var e=Call.parseCandidate(t.candidate.candidate);this.parsedCandidates.push(e),this.iceCandidateFilter(e)&&this.test.reportInfo("Gathered candidate of Type: "+e.type+" Protocol: "+e.protocol+" Address: "+e.address)}}.bind(this));var e=this.call.pc1.createDataChannel(null);e.addEventListener("open",function(){e.send("hello")}),e.addEventListener("message",function(t){"world"!==t.data?this.test.reportError("Invalid data transmitted."):this.test.reportSuccess("Data successfully transmitted between peers."),this.hangup()}.bind(this)),this.call.pc2.addEventListener("datachannel",function(t){var e=t.channel;e.addEventListener("message",function(t){"hello"!==t.data?this.hangup("Invalid data transmitted."):e.send("world")}.bind(this))}.bind(this)),this.call.establishConnection(),this.timeout=setTimeout(this.hangup.bind(this,"Timed out"),5e3)},findParsedCandidateOfSpecifiedType:function(t){for(var e in this.parsedCandidates)if(t(this.parsedCandidates[e]))return t(this.parsedCandidates[e])},hangup:function(t){t&&("Timed out"===t&&this.iceCandidateFilter.toString()===Call.isReflexive.toString()&&this.findParsedCandidateOfSpecifiedType(Call.isReflexive)?this.test.reportWarning("Could not connect using reflexive candidates, likely due to the network environment/configuration."):this.test.reportError(t)),clearTimeout(this.timeout),this.call.close(),this.test.done()}},i.default=s},{}],7:[function(t,e,i){"use strict";function s(t){this.test=t,this.testDurationSeconds=5,this.startTime=null,this.sentPayloadBytes=0,this.receivedPayloadBytes=0,this.stopSending=!1,this.samplePacket="";for(var e=0;1024!==e;++e)this.samplePacket+="h";this.maxNumberOfPacketsToSend=1,this.bytesToKeepBuffered=1024*this.maxNumberOfPacketsToSend,this.lastBitrateMeasureTime=null,this.lastReceivedPayloadBytes=0,this.call=null,this.senderChannel=null,this.receiveChannel=null}Object.defineProperty(i,"__esModule",{value:!0}),s.prototype={run:function(){Call.asyncCreateTurnConfig(this.start.bind(this),this.test.reportFatal.bind(this.test))},start:function(t){this.call=new Call(t,this.test),this.call.setIceCandidateFilter(Call.isRelay),this.senderChannel=this.call.pc1.createDataChannel(null),this.senderChannel.addEventListener("open",this.sendingStep.bind(this)),this.call.pc2.addEventListener("datachannel",this.onReceiverChannel.bind(this)),this.call.establishConnection()},onReceiverChannel:function(t){this.receiveChannel=t.channel,this.receiveChannel.addEventListener("message",this.onMessageReceived.bind(this))},sendingStep:function(){var t=new Date;this.startTime||(this.startTime=t,this.lastBitrateMeasureTime=t);for(var e=0;e!==this.maxNumberOfPacketsToSend&&!(this.senderChannel.bufferedAmount>=this.bytesToKeepBuffered);++e)this.sentPayloadBytes+=this.samplePacket.length,this.senderChannel.send(this.samplePacket);t-this.startTime>=1e3*this.testDurationSeconds?(this.test.setProgress(100),this.stopSending=!0):(this.test.setProgress((t-this.startTime)/(10*this.testDurationSeconds)),setTimeout(this.sendingStep.bind(this),1))},onMessageReceived:function(t){this.receivedPayloadBytes+=t.data.length;var e=new Date;if(1e3<=e-this.lastBitrateMeasureTime){var i=(this.receivedPayloadBytes-this.lastReceivedPayloadBytes)/(e-this.lastBitrateMeasureTime);i=Math.round(1e3*i*8)/1e3,this.test.reportSuccess("Transmitting at "+i+" kbps."),this.lastReceivedPayloadBytes=this.receivedPayloadBytes,this.lastBitrateMeasureTime=e}if(this.stopSending&&this.sentPayloadBytes===this.receivedPayloadBytes){this.call.close(),this.call=null;var s=Math.round(10*(e-this.startTime))/1e4,n=8*this.receivedPayloadBytes/1e3;this.test.reportSuccess("Total transmitted: "+n+" kilo-bits in "+s+" seconds."),this.test.done()}}},i.default=s},{}],8:[function(t,e,i){"use strict";function s(t){this.test=t,this.inputChannelCount=6,this.outputChannelCount=2,this.bufferSize=0,this.constraints={audio:{optional:[{echoCancellation:!1}]}},this.collectSeconds=2,this.silentThreshold=1/32767,this.lowVolumeThreshold=-60,this.monoDetectThreshold=1/65536,this.clipCountThreshold=6,this.clipThreshold=1,this.collectedAudio=[];for(var e=this.collectedSampleCount=0;e<this.inputChannelCount;++e)this.collectedAudio[e]=[]}Object.defineProperty(i,"__esModule",{value:!0}),s.prototype={run:function(){"undefined"==typeof audioContext?(this.test.reportError("WebAudio is not supported, test cannot run."),this.test.done()):doGetUserMedia(this.constraints,this.gotStream.bind(this))},gotStream:function(t){this.checkAudioTracks(t)?this.createAudioBuffer(t):this.test.done()},checkAudioTracks:function(t){var e=(this.stream=t).getAudioTracks();return e.length<1?(this.test.reportError("No audio track in returned stream."),!1):(this.test.reportSuccess("Audio track created using device="+e[0].label),!0)},createAudioBuffer:function(){this.audioSource=audioContext.createMediaStreamSource(this.stream),this.scriptNode=audioContext.createScriptProcessor(this.bufferSize,this.inputChannelCount,this.outputChannelCount),this.audioSource.connect(this.scriptNode),this.scriptNode.connect(audioContext.destination),this.scriptNode.onaudioprocess=this.collectAudio.bind(this),this.stopCollectingAudio=setTimeoutWithProgressBar(this.onStopCollectingAudio.bind(this),5e3)},collectAudio:function(t){for(var e=t.inputBuffer.length,i=!0,s=0;s<t.inputBuffer.numberOfChannels;s++){var n,r=t.inputBuffer.getChannelData(s),a=Math.abs(r[0]),o=Math.abs(r[e-1]);a>this.silentThreshold||o>this.silentThreshold?((n=new Float32Array(e)).set(r),i=!1):n=new Float32Array,this.collectedAudio[s].push(n)}i||(this.collectedSampleCount+=e,this.collectedSampleCount/t.inputBuffer.sampleRate>=this.collectSeconds&&this.stopCollectingAudio())},onStopCollectingAudio:function(){this.stream.getAudioTracks()[0].stop(),this.audioSource.disconnect(this.scriptNode),this.scriptNode.disconnect(audioContext.destination),this.analyzeAudio(this.collectedAudio),this.test.done()},analyzeAudio:function(t){for(var e=[],i=0;i<t.length;i++)this.channelStats(i,t[i])&&e.push(i);0===e.length?this.test.reportError("No active input channels detected. Microphone is most likely muted or broken, please check if muted in the sound settings or physically on the device. Then rerun the test."):this.test.reportSuccess("Active audio input channels: "+e.length),2===e.length&&this.detectMono(t[e[0]],t[e[1]])},channelStats:function(t,e){for(var i=0,s=0,n=0,r=0,a=0;a<e.length;a++){var o=e[a];if(0<o.length){for(var d=0,c=0,h=0;h<o.length;h++)c+=(d=Math.abs(o[h]))*d,(i=Math.max(i,d))>=this.clipThreshold?(n++,r=Math.max(r,n)):n=0;c=Math.sqrt(c/o.length),s=Math.max(s,c)}}if(i>this.silentThreshold){var u=this.dBFS(i),l=this.dBFS(s);return this.test.reportInfo("Channel "+t+" levels: "+u.toFixed(1)+" dB (peak), "+l.toFixed(1)+" dB (RMS)"),l<this.lowVolumeThreshold&&this.test.reportError("Microphone input level is low, increase input volume or move closer to the microphone."),r>this.clipCountThreshold&&this.test.reportWarning("Clipping detected! Microphone input level is high. Decrease input volume or move away from the microphone."),!0}return!1},detectMono:function(t,e){for(var i=0,s=0;s<t.length;s++){var n=t[s],r=e[s];if(n.length===r.length)for(var a=0;a<n.length;a++)Math.abs(n[a]-r[a])>this.monoDetectThreshold&&i++;else i++}0<i?this.test.reportInfo("Stereo microphone detected."):this.test.reportInfo("Mono microphone detected.")},dBFS:function(t){var e=20*Math.log(t)/Math.log(10);return Math.round(10*e)/10}},i.default=s},{}],9:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=function(t,e,i,s){this.test=t,this.protocol=e,this.params=i,this.iceCandidateFilter=s};s.prototype={run:function(){this.iceCandidateFilter.toString()===Call.isIpv6.toString()?this.gatherCandidates(null,this.params,this.iceCandidateFilter):Call.asyncCreateTurnConfig(this.start.bind(this),this.test.reportFatal.bind(this.test))},start:function(t){this.filterConfig(t,this.protocol),this.gatherCandidates(t,this.params,this.iceCandidateFilter)},filterConfig:function(t,e){for(var i="transport="+e,s=[],n=0;n<t.iceServers.length;++n){for(var r=t.iceServers[n],a=[],o=0;o<r.urls.length;++o){var d=r.urls[o];-1!==d.indexOf(i)?a.push(d):-1===d.indexOf("?transport=")&&d.startsWith("turn")&&a.push(d+"?"+i)}0!==a.length&&(r.urls=a,s.push(r))}t.iceServers=s},gatherCandidates:function(t,i,s){var n;try{n=new RTCPeerConnection(t,i)}catch(t){return null!==i&&i.optional[0].googIPv6?this.test.reportWarning("Failed to create peer connection, IPv6 might not be setup/supported on the network."):this.test.reportError("Failed to create peer connection: "+t),void this.test.done()}n.addEventListener("icecandidate",function(t){if("closed"!==t.currentTarget.signalingState)if(t.candidate){var e=Call.parseCandidate(t.candidate.candidate);s(e)&&(this.test.reportSuccess("Gathered candidate of Type: "+e.type+" Protocol: "+e.protocol+" Address: "+e.address),n.close(),n=null,this.test.done())}else n.close(),(n=null)!==i&&i.optional[0].googIPv6?this.test.reportWarning("Failed to gather IPv6 candidates, it might not be setup/supported on the network."):this.test.reportError("Failed to gather specified candidates"),this.test.done()}.bind(this)),this.createAudioOnlyReceiveOffer(n)},createAudioOnlyReceiveOffer:function(e){function i(){}e.createOffer({offerToReceiveAudio:1}).then(function(t){e.setLocalDescription(t).then(i,i)},i)}},i.default=s},{}],10:[function(t,e,i){"use strict";function s(t){this.test=t,this.maxVideoBitrateKbps=2e3,this.durationMs=4e4,this.statStepMs=100,this.bweStats=new StatisticsAggregate(.75*this.maxVideoBitrateKbps*1e3),this.rttStats=new StatisticsAggregate,this.packetsLost=-1,this.nackCount=-1,this.pliCount=-1,this.qpSum=-1,this.packetsSent=-1,this.packetsReceived=-1,this.framesEncoded=-1,this.framesDecoded=-1,this.framesSent=-1,this.bytesSent=-1,this.videoStats=[],this.startTime=null,this.call=null,this.constraints={audio:!1,video:{optional:[{minWidth:1280},{minHeight:720}]}}}Object.defineProperty(i,"__esModule",{value:!0}),s.prototype={run:function(){Call.asyncCreateTurnConfig(this.start.bind(this),this.test.reportFatal.bind(this.test))},start:function(t){this.call=new Call(t,this.test),this.call.setIceCandidateFilter(Call.isRelay),this.call.disableVideoFec(),this.call.constrainVideoBitrate(this.maxVideoBitrateKbps),doGetUserMedia(this.constraints,this.gotStream.bind(this))},gotStream:function(t){this.call.pc1.addStream(t),this.call.establishConnection(),this.startTime=new Date,this.localStream=t.getVideoTracks()[0],setTimeout(this.gatherStats.bind(this),this.statStepMs)},gatherStats:function(){var t=new Date;if(t-this.startTime>this.durationMs)return this.test.setProgress(100),void this.hangup();this.call.statsGatheringRunning||this.call.gatherStats(this.call.pc1,this.call.pc2,this.localStream,this.gotStats.bind(this)),this.test.setProgress(100*(t-this.startTime)/this.durationMs),setTimeout(this.gatherStats.bind(this),this.statStepMs)},gotStats:function(t,e,i,s){if("chrome"===adapter.browserDetails.browser)for(var n in t)void 0!==t[n].connection&&(this.bweStats.add(t[n].connection.timestamp,parseInt(t[n].connection.availableOutgoingBitrate)),this.rttStats.add(t[n].connection.timestamp,parseInt(1e3*t[n].connection.currentRoundTripTime)),this.videoStats[0]=t[n].video.local.frameWidth,this.videoStats[1]=t[n].video.local.frameHeight,this.nackCount=t[n].video.local.nackCount,this.packetsLost=i[n].video.remote.packetsLost,this.qpSum=i[n].video.remote.qpSum,this.pliCount=t[n].video.local.pliCount,this.packetsSent=t[n].video.local.packetsSent,this.packetsReceived=i[n].video.remote.packetsReceived,this.framesEncoded=t[n].video.local.framesEncoded,this.framesDecoded=i[n].video.remote.framesDecoded);else if("firefox"===adapter.browserDetails.browser)for(var r in t)"outbound_rtcp_video_0"===t[r].id?(this.rttStats.add(Date.parse(t[r].timestamp),parseInt(t[r].mozRtt)),this.jitter=t[r].jitter,this.packetsLost=t[r].packetsLost):"outbound_rtp_video_0"===t[r].id&&(this.videoStats[0]="Not supported on Firefox",this.videoStats[1]="Not supported on Firefox",this.bitrateMean=t[r].bitrateMean,this.bitrateStdDev=t[r].bitrateStdDev,this.framerateMean=t[r].framerateMean);else this.test.reportError("Only Firefox and Chrome getStats implementations are supported.");this.completed()},hangup:function(){this.call.pc1.getLocalStreams()[0].getTracks().forEach(function(t){t.stop()}),this.call.close(),this.call=null},completed:function(){"chrome"===adapter.browserDetails.browser?this.videoStats[0]<2&&this.videoStats[1]<2?this.test.reportError("Camera failure: "+this.videoStats[0]+"x"+this.videoStats[1]+". Cannot test bandwidth without a working  camera."):(this.test.reportSuccess("Video resolution: "+this.videoStats[0]+"x"+this.videoStats[1]),this.test.reportInfo("Send bandwidth estimate average: "+Math.round(this.bweStats.getAverage()/1e3)+" kbps"),this.test.reportInfo("Send bandwidth estimate max: "+this.bweStats.getMax()/1e3+" kbps"),this.test.reportInfo("Send bandwidth ramp-up time: "+this.bweStats.getRampUpTime()+" ms"),this.test.reportInfo("Packets sent: "+this.packetsSent),this.test.reportInfo("Packets received: "+this.packetsReceived),this.test.reportInfo("NACK count: "+this.nackCount),this.test.reportInfo("Picture loss indications: "+this.pliCount),this.test.reportInfo("Quality predictor sum: "+this.qpSum),this.test.reportInfo("Frames encoded: "+this.framesEncoded),this.test.reportInfo("Frames decoded: "+this.framesDecoded)):"firefox"===adapter.browserDetails.browser&&(0<parseInt(this.framerateMean)?this.test.reportSuccess("Frame rate mean: "+parseInt(this.framerateMean)):this.test.reportError("Frame rate mean is 0, cannot test bandwidth without a working camera."),this.test.reportInfo("Send bitrate mean: "+parseInt(this.bitrateMean)/1e3+" kbps"),this.test.reportInfo("Send bitrate standard deviation: "+parseInt(this.bitrateStdDev)/1e3+" kbps")),this.test.reportInfo("RTT average: "+this.rttStats.getAverage()+" ms"),this.test.reportInfo("RTT max: "+this.rttStats.getMax()+" ms"),this.test.reportInfo("Packets lost: "+this.packetsLost),this.test.done()}},i.default=s},{}],11:[function(t,e,i){"use strict";function s(t,e){this.test=t,this.candidateFilter=e,this.testDurationMs=3e5,this.sendIntervalMs=100,this.delays=[],this.recvTimeStamps=[],this.running=!1,this.call=null,this.senderChannel=null,this.receiveChannel=null}Object.defineProperty(i,"__esModule",{value:!0}),s.prototype={run:function(){Call.asyncCreateTurnConfig(this.start.bind(this),this.test.reportFatal.bind(this.test))},start:function(t){this.running=!0,this.call=new Call(t,this.test),this.chart=this.test.createLineChart(),this.call.setIceCandidateFilter(this.candidateFilter),this.senderChannel=this.call.pc1.createDataChannel({ordered:!1,maxRetransmits:0}),this.senderChannel.addEventListener("open",this.send.bind(this)),this.call.pc2.addEventListener("datachannel",this.onReceiverChannel.bind(this)),this.call.establishConnection(),setTimeoutWithProgressBar(this.finishTest.bind(this),this.testDurationMs)},onReceiverChannel:function(t){this.receiveChannel=t.channel,this.receiveChannel.addEventListener("message",this.receive.bind(this))},send:function(){this.running&&(this.senderChannel.send(""+Date.now()),setTimeout(this.send.bind(this),this.sendIntervalMs))},receive:function(t){if(this.running){var e=parseInt(t.data),i=Date.now()-e;this.recvTimeStamps.push(e),this.delays.push(i),this.chart.addDatapoint(e+i,i)}},finishTest:function(){report.traceEventInstant("periodic-delay",{delays:this.delays,recvTimeStamps:this.recvTimeStamps}),this.running=!1,this.call.close(),this.call=null,this.chart.parentElement.removeChild(this.chart);var t=arrayAverage(this.delays),e=arrayMax(this.delays),i=arrayMin(this.delays);this.test.reportInfo("Average delay: "+t+" ms."),this.test.reportInfo("Min delay: "+i+" ms."),this.test.reportInfo("Max delay: "+e+" ms."),this.delays.length<.8*this.testDurationMs/this.sendIntervalMs?this.test.reportError("Not enough samples gathered. Keep the page on  the foreground while the test is running."):this.test.reportSuccess("Collected "+this.delays.length+" delay samples."),2*(i+100)<e&&this.test.reportError("There is a big difference between the min and max delay of packets. Your network appears unstable."),this.test.done()}},i.default=s},{}],12:[function(t,e,i){"use strict";function n(t,e){this.test=e,this.traceEvent=report.traceEventAsync("call"),this.traceEvent({config:t}),this.statsGatheringRunning=!1,this.pc1=new RTCPeerConnection(t),this.pc2=new RTCPeerConnection(t),this.pc1.addEventListener("icecandidate",this.onIceCandidate_.bind(this,this.pc2)),this.pc2.addEventListener("icecandidate",this.onIceCandidate_.bind(this,this.pc1)),this.iceCandidateFilter_=n.noFilter}Object.defineProperty(i,"__esModule",{value:!0}),n.prototype={establishConnection:function(){this.traceEvent({state:"start"}),this.pc1.createOffer().then(this.gotOffer_.bind(this),this.test.reportFatal.bind(this.test))},close:function(){this.traceEvent({state:"end"}),this.pc1.close(),this.pc2.close()},setIceCandidateFilter:function(t){this.iceCandidateFilter_=t},constrainVideoBitrate:function(t){this.constrainVideoBitrateKbps_=t},disableVideoFec:function(){this.constrainOfferToRemoveVideoFec_=!0},gatherStats:function(t,e,i,s){var n=[],r=[],a=[],o=[],d=this,c=100;function h(){if("closed"===t.signalingState)return d.statsGatheringRunning=!1,void s(n,a,r,o);t.getStats().then(l).catch(function(t){d.test.reportError("Could not gather stats: "+t),d.statsGatheringRunning=!1,s(n,a)}.bind(d)),e&&e.getStats().then(u)}function u(t){if("chrome"===adapter.browserDetails.browser){var e=enumerateStats(t,d.localTrackIds,d.remoteTrackIds);r.push(e),o.push(Date.now())}else if("firefox"===adapter.browserDetails.browser)for(var i in t){var s=t[i];r.push(s),o.push(Date.now())}else d.test.reportError("Only Firefox and Chrome getStats implementations are supported.")}function l(t){if("chrome"===adapter.browserDetails.browser){var e=enumerateStats(t,d.localTrackIds,d.remoteTrackIds);n.push(e),a.push(Date.now())}else if("firefox"===adapter.browserDetails.browser)for(var i in t){var s=t[i];n.push(s),a.push(Date.now())}else d.test.reportError("Only Firefox and Chrome getStats implementations are supported.");setTimeout(h,c)}d.localTrackIds={audio:"",video:""},d.remoteTrackIds={audio:"",video:""},t.getSenders().forEach(function(t){"audio"===t.track.kind?d.localTrackIds.audio=t.track.id:"video"===t.track.kind&&(d.localTrackIds.video=t.track.id)}.bind(d)),e&&e.getReceivers().forEach(function(t){"audio"===t.track.kind?d.remoteTrackIds.audio=t.track.id:"video"===t.track.kind&&(d.remoteTrackIds.video=t.track.id)}.bind(d)),this.statsGatheringRunning=!0,h()},gotOffer_:function(t){this.constrainOfferToRemoveVideoFec_&&(t.sdp=t.sdp.replace(/(m=video 1 [^\r]+)(116 117)(\r\n)/g,"$1\r\n"),t.sdp=t.sdp.replace(/a=rtpmap:116 red\/90000\r\n/g,""),t.sdp=t.sdp.replace(/a=rtpmap:117 ulpfec\/90000\r\n/g,""),t.sdp=t.sdp.replace(/a=rtpmap:98 rtx\/90000\r\n/g,""),t.sdp=t.sdp.replace(/a=fmtp:98 apt=116\r\n/g,"")),this.pc1.setLocalDescription(t),this.pc2.setRemoteDescription(t),this.pc2.createAnswer().then(this.gotAnswer_.bind(this),this.test.reportFatal.bind(this.test))},gotAnswer_:function(t){this.constrainVideoBitrateKbps_&&(t.sdp=t.sdp.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+this.constrainVideoBitrateKbps_+"\r\n")),this.pc2.setLocalDescription(t),this.pc1.setRemoteDescription(t)},onIceCandidate_:function(t,e){if(e.candidate){var i=n.parseCandidate(e.candidate.candidate);this.iceCandidateFilter_(i)&&t.addIceCandidate(e.candidate)}}},n.noFilter=function(){return!0},n.isRelay=function(t){return"relay"===t.type},n.isNotHostCandidate=function(t){return"host"!==t.type},n.isReflexive=function(t){return"srflx"===t.type},n.isHost=function(t){return"host"===t.type},n.isIpv6=function(t){return-1!==t.address.indexOf(":")},n.parseCandidate=function(t){var e="candidate:",i=t.indexOf(e)+e.length,s=t.substr(i).split(" ");return{type:s[7],protocol:s[2],address:s[4]}},n.cachedIceServers_=null,n.cachedIceConfigFetchTime_=null,n.asyncCreateTurnConfig=function(i,t){var e=currentTest.settings;if("string"==typeof e.turnURI&&""!==e.turnURI){var s={iceServers:[{username:e.turnUsername||"",credential:e.turnCredential||"",urls:e.turnURI.split(",")}]};report.traceEventInstant("turn-config",s),setTimeout(i.bind(null,s),0)}else n.fetchTurnConfig_(function(t){var e={iceServers:t.iceServers};report.traceEventInstant("turn-config",e),i(e)},t)},n.asyncCreateStunConfig=function(i,t){var e=currentTest.settings;if("string"==typeof e.stunURI&&""!==e.stunURI){var s={iceServers:[{urls:e.stunURI.split(",")}]};report.traceEventInstant("stun-config",s),setTimeout(i.bind(null,s),0)}else n.fetchTurnConfig_(function(t){var e={iceServers:t.iceServers.urls};report.traceEventInstant("stun-config",e),i(e)},t)},n.fetchTurnConfig_=function(e,i){if(n.cachedIceServers_&&!((Date.now()-n.cachedIceConfigFetchTime_)/1e3>parseInt(n.cachedIceServers_.lifetimeDuration)-240))return report.traceEventInstant("fetch-ice-config","Using cached credentials."),void e(n.getCachedIceCredentials_());var s=new XMLHttpRequest;s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status){var t=JSON.parse(s.responseText);n.cachedIceServers_=t,n.getCachedIceCredentials_=function(){return JSON.parse(JSON.stringify(n.cachedIceServers_))},n.cachedIceConfigFetchTime_=Date.now(),report.traceEventInstant("fetch-ice-config","Fetching new credentials."),e(n.getCachedIceCredentials_())}else i("TURN request failed")},s.open("POST","https://networktraversal.googleapis.com/v1alpha/iceconfig?key="+void 0,!0),s.send()},i.default=n},{}],13:[function(t,e,i){"use strict";function s(){this.output_=[],this.nextAsyncId_=0,this.nativeLog_=console.log.bind(console),console.log=this.logHook_.bind(this),window.addEventListener("error",this.onWindowError_.bind(this)),this.traceEventInstant("system-info",s.getSystemInfo())}s.prototype={traceEventInstant:function(t,e){this.output_.push({ts:Date.now(),name:t,args:e})},traceEventWithId:function(t,e,i){this.output_.push({ts:Date.now(),name:t,id:e,args:i})},traceEventAsync:function(t){return this.traceEventWithId.bind(this,t,this.nextAsyncId_++)},logTestRunResult:function(t,e){ga("send",{hitType:"event",eventCategory:"Test",eventAction:e,eventLabel:t,nonInteraction:1})},generate:function(t){var e={title:"WebRTC Troubleshooter bug report",description:t||null};return this.getContent_(e)},getContent_:function(t){var e=[];return this.appendEventsAsString_([t],e),this.appendEventsAsString_(this.output_,e),"["+e.join(",\n")+"]"},appendEventsAsString_:function(t,e){for(var i=0;i!==t.length;++i)e.push(JSON.stringify(t[i]))},onWindowError_:function(t){this.traceEventInstant("error",{message:t.message,filename:t.filename+":"+t.lineno})},logHook_:function(){this.traceEventInstant("log",arguments),this.nativeLog_.apply(null,arguments)}},s.getSystemInfo=function(){var t,e,i,s=navigator.userAgent,n=navigator.appName,r=""+parseFloat(navigator.appVersion);return-1!==(e=s.indexOf("Chrome"))?(n="Chrome",r=s.substring(e+7)):-1!==(e=s.indexOf("MSIE"))?(n="Microsoft Internet Explorer",r=s.substring(e+5)):-1!==(e=s.indexOf("Trident"))?(n="Microsoft Internet Explorer",r=s.substring(e+8)):-1!==(e=s.indexOf("Firefox"))?n="Firefox":-1!==(e=s.indexOf("Safari"))?(n="Safari",r=s.substring(e+7),-1!==(e=s.indexOf("Version"))&&(r=s.substring(e+8))):(t=s.lastIndexOf(" ")+1)<(e=s.lastIndexOf("/"))&&(n=s.substring(t,e),r=s.substring(e+1),n.toLowerCase()===n.toUpperCase()&&(n=navigator.appName)),-1!==(i=r.indexOf(";"))&&(r=r.substring(0,i)),-1!==(i=r.indexOf(" "))&&(r=r.substring(0,i)),{browserName:n,browserVersion:r,platform:navigator.platform}};new s},{}],14:[function(t,e,i){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function n(){}n.prototype={statistics:function(t){var e,i=0;for(e=0;e<t.length;++e)i+=t[e];var s=i/(t.length-1),n=0;for(e=1;e<t.length;++e)n=t[e-1]-s,i+=t[e]+n*n;return{mean:s,variance:i/t.length}},covariance:function(t,e,i,s){for(var n=0,r=0;r<t.length;r+=1)n+=(t[r]-i)*(e[r]-s);return n/t.length},calculate:function(t,e){if(t.length!==e.length)return 0;var i=6.502500000000001,s=.03*255*(.03*255),n=s/2,r=this.statistics(t),a=r.mean,o=r.variance,d=Math.sqrt(o),c=this.statistics(e),h=c.mean,u=c.variance,l=Math.sqrt(u);return(2*a*h+i)/(a*a+h*h+i)*((2*d*l+s)/(o+u+s))*((this.covariance(t,e,a,h)+n)/(d*l+n))}},"object"===(void 0===i?"undefined":s(i))&&(e.exports=n)},{}],15:[function(t,e,i){"use strict"},{}],16:[function(t,e,i){"use strict"},{}],17:[function(t,e,i){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function n(t){this.frameStats={numFrozenFrames:0,numBlackFrames:0,numFrames:0},this.running_=!0,this.nonBlackPixelLumaThreshold=20,this.previousFrame_=[],this.identicalFrameSsimThreshold=.985,this.frameComparator=new Ssim,this.canvas_=document.createElement("canvas"),this.videoElement_=t,this.listener_=this.checkVideoFrame_.bind(this),this.videoElement_.addEventListener("play",this.listener_,!1)}n.prototype={stop:function(){this.videoElement_.removeEventListener("play",this.listener_),this.running_=!1},getCurrentImageData_:function(){this.canvas_.width=this.videoElement_.width,this.canvas_.height=this.videoElement_.height;var t=this.canvas_.getContext("2d");return t.drawImage(this.videoElement_,0,0,this.canvas_.width,this.canvas_.height),t.getImageData(0,0,this.canvas_.width,this.canvas_.height)},checkVideoFrame_:function(){if(this.running_&&!this.videoElement_.ended){var t=this.getCurrentImageData_();this.isBlackFrame_(t.data,t.data.length)&&this.frameStats.numBlackFrames++,this.frameComparator.calculate(this.previousFrame_,t.data)>this.identicalFrameSsimThreshold&&this.frameStats.numFrozenFrames++,this.previousFrame_=t.data,this.frameStats.numFrames++,setTimeout(this.checkVideoFrame_.bind(this),20)}},isBlackFrame_:function(t,e){for(var i=this.nonBlackPixelLumaThreshold,s=0,n=4;n<e;n+=4)if(i*n/4<(s+=.21*t[n]+.72*t[n+1]+.07*t[n+2]))return!1;return!0}},"object"===(void 0===i?"undefined":s(i))&&(e.exports=n)},{}]},{},[1,2,3,4,6,7,8,9,10,11,12,13,14,15,16,17]);